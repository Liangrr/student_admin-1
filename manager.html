<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>错题系统</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/bootstrap.css">
	<style>
		.wq-title {
			padding-bottom: 40px;

		}

		.wq-title:hover {
			transition: all .5s;
			text-shadow: 0 0 5px #999;
		}

		.wq-main-table thead {
			background: rgba(0, 0, 0, .3);
			color: #333;
		}

		.wq-main-table td {
			max-height: 50px;
			word-break: break-all;
		}

		.center-vertical {
			position: relative;
			top: 50%;
			transform: translateY(-50%);
		}

		.wq-add .modal-content {
			padding: 20px;
		}
	</style>
</head>

<body>

	<div class="container-fluid">
		<h3 class="wq-title">
			<span class="logo">
				<img src="http://www.qfedu.com/images/new_logo.png" alt="">
			</span>
			成绩管理
			<button type="button" class="btn" data-toggle="modal" data-target=".wq-add">
				<span class="glyphicon glyphicon-cog" aria-hidden="true"></span>
				添加成绩
			</button>
		</h3>
		<!-- 添加错题部分 -->
		<div class="modal fade wq-add">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<!--细节划分-->
					<h4>添加学生信息:</h4>
					<div class="form-group">
						<label for="wq-name">学生姓名</label>
						<input type="text" class="form-control" id="wq-name" placeholder="学生姓名" value="">
					</div>
					<div class="form-group">
						<label for="wq-score">学生成绩</label>
						<input type="text" class="form-control" id="wq-score" placeholder="学生成绩" value="">
					</div>
					<div class="form-group">
						<label for="wq-mark">添加备注</label>
						<textarea id="wq-mark" class="form-control" rows="2" placeholder="添加备注"></textarea>
					</div>
					<div class="text-center">
						<button type="button" class="btn btn-success" data-dismiss="modal" id="wq-save-score">提交</button>
					</div>
				</div>
			</div>
		</div>
		<!--错题表格-->
		<div class="row">
			<table class="table table-bordered table-hover wq-main-table ">
				<!--错题项目-->
				<thead>
					<tr>
						<th class="col-md-1 text-center">编号</th>
						<th class="col-md-3 text-center">姓名</th>
						<th class="col-md-3 text-center">成绩</th>
						<th class="col-md-3 text-center">备注</th>
						<th class="col-md-2 text-center">操作</th>
					</tr>
				</thead>
				<tbody id="tbody">
					<!-- <tr class="text-center middle"> -->
					<!-- <td>1</td>
								<td>王京</td>
								<td>88</td>
								<td>这次没有上次考的好</td>
								<td>
									<button class="btn btn-danger">删除</button>
									<button class="btn btn-warning">修改</button>
								</td>
							</tr> -->
					<!-- 
						
						******结构示例*****
						
						<tr class="text-center middle">
						<td>**索引**</td>
						<td>**姓名**</td>
						<td>**分数**</td>
						<td>备注</td>
						<td>
							<button class="btn">删除</button>
							<button class="btn">修改</button>
						</td>
					</tr> -->
				</tbody>
			</table>
		</div>

	</div>

</body>
<script src="js/jquery.js"></script>
<script src="js/bootstrap.js"></script>
<script>
	var manager = (function () {
		$saveBtn = $('#wq-save-score');
		$tbody = $("#tbody");
		var data = [];
		return {
			init: function () {
				var _this = this;
				this.getData();
				this.events();
				// 添加一条数据
			},
			events: function() {
				var _this = this;
				$saveBtn.click(function () {
					var params = {
						student_name: $('#wq-name').val(),
						score: $('#wq-score').val(),
						mark: $('#wq-mark').val()
					}
					$.post('php/insert.php', params, function (json) {
						if (json.code == 0) {
							data.push(json.data);
							_this.initData(data);
						}
					}, "json")
				})
				$tbody.on("click", ".btn-danger", function (e) {
					var tr = $(this).closest('tr');
					var params = {
						id: tr.find("td").eq(0).html()
					}
					$.post('php/del.php', params, function (json) {
						if (json.code == 200) {
							tr.remove();
						}
					}, "json")
				})
			},
			getData() {
				var _this = this
				$.post('php/get_date.php', function (json) {
						if (json.code == 0) {
							data = json.data;
							_this.initData(data);
						}
					}, "json")
			},
			initData(data) {
				$tbody.html('');
				var frag = document.createDocumentFragment();
				for (var i = 0; i < data.length; i++) {
					var tr = document.createElement('tr');
					tr.className = "text-center middle";
					for (var t in data[i]) {
						var td = document.createElement('td');
						td.innerHTML = data[i][t];
						tr.appendChild(td);
					}
					var td = document.createElement('td');
					td.innerHTML = "<button class='btn btn-warning'>修改</button> <button class='btn btn-danger'>删除</button>"
					tr.appendChild(td);
					frag.appendChild(tr);
				}
				$tbody.append(frag);
			}
		}
	})()
	manager.init();
</script>

</html>